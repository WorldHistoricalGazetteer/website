{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://whgazetteer.org/schema/lpf_v2.0.jsonld",
    "title": "Linked Places Format: FeatureCollection",
    "type": "object",
    "@context": "https://whgazetteer.org/schema/lpo_v2.0.jsonld",
    "required": [
        "type",
        "features"
    ],
    "properties": {
        "type": {
            "type": "string",
            "enum": [
                "FeatureCollection"
            ]
        },
        "features": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/feature"
            },
            "minItems": 1
        }
    },
    "definitions": {
        "feature": {
            "type": "object",
            "required": [
                "@id",
                "type",
                "properties",
                "geometry",
                "names"
            ],
            "properties": {
                "type": {
                    "type": "string",
                    "enum": [
                        "Feature"
                    ]
                },
                "@id": {
                    "type": "string",
                    "default": "",
                    "examples": [
                        "https://foofah.com"
                    ],
                    "pattern": "^(.*)$"
                },
                "properties": {
                    "type": "object",
                    "required": [
                        "title"
                    ],
                    "properties": {
                        "title": {
                            "type": "string",
                            "default": "",
                            "examples": [
                                "San Miguel"
                            ],
                            "pattern": "^(.*)$"
                        },
                        "ccodes": {
                            "$ref": "#/definitions/ccodes"
                        },
                        "fclasses": {
                            "$ref": "#/definitions/fclasses"
                        }
                    }
                },
                "names": {
                    "$ref": "#/definitions/names"
                },
                "types": {
                    "$ref": "#/definitions/types"
                },
                "geometry": {
                    "$ref": "#/definitions/geometry"
                },
                "relations": {
                    "$ref": "#/definitions/relations"
                },
                "when": {
                    "$ref": "#/definitions/time/definitions/when"
                },
                "links": {
                    "$ref": "#/definitions/links"
                },
                "depictions": {
                    "$ref": "#/definitions/depictions"
                },
                "descriptions": {
                    "$ref": "#/definitions/descriptions"
                }
            }
        },
        "names": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "toponym": {
                        "type": "string",
                        "examples": [
                            "San Miguel"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "ethnonym": {
                        "type": "string",
                        "examples": [
                            "Lebenians"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "when": {
                        "$ref": "#/definitions/time/definitions/when"
                    },
                    "lang": {
                        "$ref": "#/definitions/lang"
                    },
                    "citations": {
                        "$ref": "#/definitions/citations"
                    }
                },
                "oneOf": [
                    {
                        "required": [
                            "toponym"
                        ]
                    },
                    {
                        "required": [
                            "ethnonym"
                        ]
                    }
                ],
                "additionalProperties": true
            }
        },
        "citations": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/citation"
            }
        },
        "citation": {
            "type": "object",
            "properties": {
                "@id": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "examples": [
                        "http://foofah.org"
                    ]
                },
                "label": {
                    "type": "string",
                    "examples": [
                        "Blow, J. (1708)"
                    ],
                    "pattern": "^(.*)$"
                }
            }
        },
        "lang": {
            "type": "string",
            "examples": [
                "en",
                "fr"
            ],
            "pattern": "^[a-z]{2}$"
        },
        "certainty": {
            "type": "string",
            "enum": [
                "certain",
                "less-certain",
                "uncertain"
            ]
        },
        "license": {
            "type": "string",
            "default": "",
            "examples": [
                "cc:by-sa/3.0/"
            ],
            "pattern": "^(.*)$"
        },
        "ccodes": {
            "type": "array",
            "items": {
                "type": "string",
                "default": "",
                "examples": [
                    "CR"
                ],
                "pattern": "^([A-Z]{2})$"
            }
        },
        "fclasses": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "descriptions": {
            "type": "array",
            "items": {
                "type": "object",
                "required": [
                    "value"
                ],
                "properties": {
                    "@id": {
                        "type": "string",
                        "examples": [
                            "https://en.wikipedia.org/wiki/Abingdon-on-Thames"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "value": {
                        "type": "string",
                        "examples": [
                            "...a historic market town and civil parish..."
                        ],
                        "pattern": "^(.*)$"
                    },
                    "lang": {
                        "$ref": "#/definitions/lang"
                    }
                }
            }
        },
        "links": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": [
                            "closeMatch",
                            "exactMatch",
                            "primaryTopicOf",
                            "subjectOf",
                            "seeAlso"
                        ]
                    },
                    "identifier": {
                        "type": "string"
                    }
                }
            }
        },
        "relations": {
            "type": "array",
            "items": {
                "allOf": [
                    { "$ref": "#/definitions/optionalProperties" },
                    {
		                "type": "object",
		                "required": [
		                    "relationType",
		                    "relationTo",
		                    "label"
		                ],
		                "properties": {
		                    "relationType": {
		                        "type": "string",
		                        "examples": [
		                            "gvp:broaderPartitive"
		                        ],
		                        "pattern": "^(.*)$"
		                    },
		                    "relationTo": {
		                        "type": "string",
		                        "pattern": "^(.*)$"
		                    },
		                    "label": {
		                        "type": "string",
		                        "pattern": "^(.*)$"
		                    }
		                }
                    }
                ]
            }
        },
        "types": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "label": {
                        "type": "string",
                        "default": "",
                        "examples": [
                            "village"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "identifier": {
                        "type": "string",
                        "default": "",
                        "examples": [
                            "aat:300008372"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "sourceLabels": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "label": {
                                    "type": "string",
                                    "examples": [
                                        "Pueblo"
                                    ],
                                    "pattern": "^(.*)$"
                                },
                                "lang": {
                                    "$ref": "#/definitions/lang"
                                }
                            },
                            "required": [
                                "label"
                            ]
                        }
                    },
                    "when": {
                        "$ref": "#/definitions/time/definitions/when"
                    }
                }
            }
        },
        "depictions": {
            "type": "array",
            "items": {
                "type": "object",
                "required": [
                    "@id",
                    "title",
                    "license"
                ],
                "properties": {
                    "@id": {
                        "type": "string",
                        "examples": [
                            "https://commons.wikimedia.org/wiki/File:ThamesAtAbingdon.jpg"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "title": {
                        "type": "string",
                        "default": "",
                        "examples": [
                            "The River Thames at Abingdon, Oxfordshire"
                        ],
                        "pattern": "^(.*)$"
                    },
                    "license": {
                        "$ref": "#/definitions/license"
                    }
                }
            }
        },
        "time": {
            "definitions": {
                "when": {
                    "type": "object",
                    "properties": {
                        "timespans": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/time/definitions/timespan"
                            }
                        },
                        "periods": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/time/definitions/period"
                            }
                        },
                        "certainty": {
                            "$ref": "#/definitions/certainty"
                        },
                        "label": {
                            "type": "string"
                        },
                        "duration": {
                            "$ref": "#/definitions/time/definitions/duration"
                        }
                    }
                },
                "dateString": {
                    "type": "string",
                    "pattern": "^(-?\\d{5,})$|^(-?\\d{1,4})(-(0[1-9]|1[0-2]))?(-([0-2][0-9]|3[01]))?$",
                    "description": "A string representing a date. The format can be: A year with five or more digits (e.g., '-10000'); A year with four digits (e.g., '2024'), optionally followed by a month (e.g., '2024-08') and/or a day (e.g., '2024-08-19'). Negative years are supported and must be represented with a leading '-' sign. Months and days must be within valid ranges."
                },
                "dateObject": {
                    "type": "object",
                    "properties": {
                        "in": {
                            "$ref": "#/definitions/time/definitions/dateString"
                        },
                        "earliest": {
                            "$ref": "#/definitions/time/definitions/dateString"
                        },
                        "latest": {
                            "$ref": "#/definitions/time/definitions/dateString"
                        }
                    },
                    "oneOf": [
                        {
                            "required": [
                                "in"
                            ]
                        },
                        {
                            "oneOf": [
                                {
                                    "required": [
                                        "earliest"
                                    ]
                                },
                                {
                                    "required": [
                                        "latest"
                                    ]
                                }
                            ],
                            "not": {
                                "required": [
                                    "in"
                                ]
                            }
                        }
                    ],
                    "additionalProperties": false
                },
                "timespan": {
                    "type": "object",
                    "properties": {
                        "start": {
                            "$ref": "#/definitions/time/definitions/dateObject"
                        },
                        "end": {
                            "$ref": "#/definitions/time/definitions/dateObject"
                        }
                    },
                    "required": [
                        "start"
                    ],
                    "additionalProperties": false
                },
                "period": {
                    "type": "object",
                    "properties": {
                        "name": {
                            "type": "string"
                        },
                        "uri": {
                            "type": "string"
                        }
                    }
                },
                "duration": {
                    "type": "string",
                    "examples": [
                        "P1Y",
                        "P2M"
                    ],
                    "pattern": "^P\\d+[Y|M|D]$"
                }
            }
        },
        "optionalProperties": {
            "type": "object",
            "properties": {
                "when": {
                    "$ref": "#/definitions/time/definitions/when"
                },
                "citations": {
                    "$ref": "#/definitions/citations"
                },
                "certainty": {
                    "$ref": "#/definitions/certainty"
                }
            }
        },
        "geometry": {
            "oneOf": [
                {
                    "type": "null"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/point"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/linestring"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/polygon"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/multipoint"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/multilinestring"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/multipolygon"
                },
                {
                    "$ref": "#/definitions/geometry/definitions/geometrycollection"
                }
            ],
            "definitions": {
                "point": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON Point",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "Point"
		                            ]
		                        },
		                        "coordinates": {
		                            "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "linestring": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON LineString",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "LineString"
		                            ]
		                        },
		                        "coordinates": {
		                            "type": "array",
		                            "minItems": 2,
		                            "items": {
		                                "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                            }
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "polygon": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON Polygon",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "Polygon"
		                            ]
		                        },
		                        "coordinates": {
		                            "type": "array",
		                            "items": {
		                                "type": "array",
		                                "minItems": 4,
		                                "items": {
		                                    "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                                }
		                            }
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "multipoint": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON MultiPoint",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "MultiPoint"
		                            ]
		                        },
		                        "coordinates": {
		                            "type": "array",
		                            "items": {
		                                "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                            }
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "multilinestring": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON MultiLineString",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "MultiLineString"
		                            ]
		                        },
		                        "coordinates": {
		                            "type": "array",
		                            "items": {
		                                "type": "array",
		                                "minItems": 2,
		                                "items": {
		                                    "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                                }
		                            }
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "multipolygon": {
	                "allOf": [
	                    { "$ref": "#/definitions/optionalProperties" },
	                    {
		                    "title": "GeoJSON MultiPolygon",
		                    "type": "object",
		                    "required": [
		                        "type",
		                        "coordinates"
		                    ],
		                    "properties": {
		                        "type": {
		                            "type": "string",
		                            "enum": [
		                                "MultiPolygon"
		                            ]
		                        },
		                        "coordinates": {
		                            "type": "array",
		                            "items": {
		                                "type": "array",
		                                "items": {
		                                    "type": "array",
		                                    "minItems": 4,
		                                    "items": {
		                                        "$ref": "#/definitions/geometry/definitions/coordinate_pair"
		                                    }
		                                }
		                            }
		                        },
		                        "bbox": {
		                            "$ref": "#/definitions/geometry/definitions/bbox"
		                        }
		                    }
	                    }
	                ]
                },
                "geometrycollection": {
                    "title": "GeoJSON GeometryCollection",
                    "type": "object",
                    "required": [
                        "type",
                        "geometries"
                    ],
                    "properties": {
                        "type": {
                            "type": "string",
                            "enum": [
                                "GeometryCollection"
                            ]
                        },
                        "geometries": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/geometry"
                            }
                        }
                    }
                },
                "coordinate_pair": {
                    "type": "array",
                    "items": [
                        {
                            "$ref": "#/definitions/geometry/definitions/longitude"
                        },
                        {
                            "$ref": "#/definitions/geometry/definitions/latitude"
                        }
                    ],
                    "maxItems": 2,
                    "minItems": 2
                },
                "bbox": {
                    "type": "array",
                    "items": [
                        {
                            "$ref": "#/definitions/geometry/definitions/longitude"
                        },
                        {
                            "$ref": "#/definitions/geometry/definitions/latitude"
                        },
                        {
                            "$ref": "#/definitions/geometry/definitions/longitude"
                        },
                        {
                            "$ref": "#/definitions/geometry/definitions/latitude"
                        }
                    ],
                    "maxItems": 4,
                    "minItems": 4
                },
                "longitude": {
                    "maximum": 180,
                    "minimum": -180,
                    "type": "number"
                },
                "latitude": {
                    "maximum": 90,
                    "minimum": -90,
                    "type": "number"
                }
            }
        }
    }
}