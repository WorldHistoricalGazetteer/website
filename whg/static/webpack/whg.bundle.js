(()=>{"use strict";function e(e,t){const a=t.max-t.min,n=e.value-t.min,i=t.value-t.min;t.style.zIndex="3",t.style.background=`linear-gradient(\n    to right,\n    var(--slider-background) 0%,\n    var(--slider-background) ${n/a*100}%,\n    var(--range-color) ${n/a*100}%,\n    var(--range-color) ${i/a*100}%,\n    var(--slider-background) ${i/a*100}%,\n    var(--slider-background) 100%)`}function a(e,t){return e===t?`${e}`:`${e}-${t}`}function n(e,t){const a=document.createElement("div");a.classList.add("value-label"),a.textContent=t,e.appendChild(a);const n=a.offsetWidth;return e.removeChild(a),{element:a,width:n}}class o{constructor({fromValue:e=1300,toValue:t=1964,minValue:a=1066,maxValue:n=2e3,onChange:i=null,open:o=!1,epochs:l=!0,automate:s=!0}){this.fromValue=e,this.toValue=t,this.minValue=a,this.maxValue=n,this.open=o,this.epochs=l,this.automate=s,this.createSliderElements(),this.updateFormInputs(),this.addGoogleFont(),this.observeResize(),this.onChangeCallback=i}addGoogleFont(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=REM&display=swap",e.rel="stylesheet",document.head.appendChild(e);const t=document.createElement("style");t.innerHTML="\n\t      .range_container {\n\t        font-family: 'REM', sans-serif;\n\t      }\n\t    ",document.head.appendChild(t)}createSliderElements(){const t=`\n\t\t\t<div class="range_container">\n\t\t\t\t<div class="form_control">\n\t\t\t\t\t<div class="control_container from">\n\t\t\t\t\t\t<button class="year_button">${this.fromValue}</button>\n\t\t\t\t\t\t${this.epochs?'<button class="epochs_button" title="Set range from a defined epoch.">Epochs</button>':""}\n\t\t\t\t\t\t${this.automate?'<button class="automate_button" title="Automate slider movement.">Automate</button>':""}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="control_container to">\n\t\t\t\t\t\t<button class="year_button">${this.toValue}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<input type="range" value="${this.fromValue}" min="${this.minValue}" max="${this.maxValue}" class="slider from" id="fromSlider">\n\t\t\t\t<input type="range" value="${this.toValue}" min="${this.minValue}" max="${this.maxValue}" class="slider to" id="toSlider">\n\t\t\t\t<div class="tooltip">${a(this.fromValue,this.toValue)}</div>\n\t\t\t\t<div class="scale-container"></div>\n\t\t\t\t<button class="dateline-button expanded" title="Toggle date filtering"><span></span></button>\n\t\t\t</div>\n\t\t`,n=new DOMParser;this.rangeContainer=n.parseFromString(t,"text/html").body.firstChild,document.getElementById("dateline").appendChild(this.rangeContainer);const i=document.querySelector(".dateline-button");this.rangeContainer.parentNode.insertBefore(i,this.rangeContainer),i.addEventListener("click",(()=>{this.rangeContainer.classList.contains("transitioned")&&this.rangeContainer.classList.remove("transitioned"),this.rangeContainer.classList.toggle("expanded");const e=t=>{"max-width"===t.propertyName&&this.rangeContainer.classList.contains("expanded")&&(this.scaleContainer.hasChildNodes()||this.addSliderScale(this.scaleContainer),this.rangeContainer.removeEventListener("transitionend",e),this.rangeContainer.classList.add("transitioned"))};this.rangeContainer.addEventListener("transitionend",e)})),this.fromSlider=this.rangeContainer.querySelector(".slider.from"),this.toSlider=this.rangeContainer.querySelector(".slider.to"),this.tooltip=this.rangeContainer.querySelector(".tooltip"),this.scaleContainer=this.rangeContainer.querySelector(".scale-container"),e(this.fromSlider,this.toSlider);const o=e=>{const t=this.fromSlider,n=t.getBoundingClientRect(),i=t.offsetWidth;let o;if(void 0!==e.clientX)o=e.clientX-n.left;else{if(!e.changedTouches||void 0===e.changedTouches[0].clientX)return;o=e.changedTouches[0].clientX-n.left}this.tooltip.textContent=a(this.fromSlider.value,this.toSlider.value);const l=this.tooltip.offsetWidth,s=o-l/2,r=i-l;this.tooltip.style.left=`${Math.min(r,Math.max(0,s))}px`};if(this.rangeContainer.addEventListener("mouseleave",(()=>{this.tooltip.style.opacity=0})),[this.fromSlider,this.toSlider].forEach((e=>{e.addEventListener("mouseenter",(()=>{this.tooltip.style.opacity=1})),e.addEventListener("mouseleave",(()=>{this.tooltip.style.opacity=0})),e.addEventListener("mousemove",(e=>{o(e)})),e.addEventListener("input",(e=>{e.target.classList.contains("to")?(this.toValue=parseInt(e.target.value),this.toValue<=this.fromValue&&(this.fromValue=this.toValue,this.fromSlider.value=this.fromValue)):(this.fromValue=parseInt(e.target.value),this.fromValue>=this.toValue&&(this.toValue=this.fromValue,this.toSlider.value=this.toValue)),this.updateFormInputs()}))})),this.open){document.querySelector(".dateline-button").click(),this.rangeContainer.classList.add("transitioned")}}observeResize(){this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===document.getElementById("dateline")&&this.rangeContainer.classList.contains("expanded")&&this.addSliderScale(this.scaleContainer)})),this.resizeObserver.observe(document.getElementById("dateline"))}addSliderScale(e){const t=Math.floor(e.offsetWidth/(1.6*n(e,this.maxValue).width)),a=this.maxValue-this.minValue,i=Math.floor(a/t).toString().length,{firstLabel:o,lastLabel:l,labelCount:s,divisor:r,division:c,firstTick:d,tickStep:p}=function(e,t,a,n,i){for(const o of n){const n=Math.pow(10,a-1)*o,l=Math.ceil(e/n)*n,s=Math.floor(t/n)*n,r=1+(s-l)/n;if(r<i){let t=l;const a=n/o;for(;t>=e;)t-=a;return t+=a,{firstLabel:l,lastLabel:s,labelCount:r,divisor:n,division:o,firstTick:t,tickStep:a}}}return console.log("No label scaling determined."),{}}(this.minValue,this.maxValue,i,[1,2,5,10,20,50],t);e.innerHTML="";let u=d;for(;u<=this.maxValue;){const t=document.createElement("div");if(t.classList.add("tick"),t.style.left=(u-this.minValue)/a*100+"%",u%r==0){t.classList.add("labeled-tick");const{element:i,width:o}=n(e,u);i.textContent=u,e.appendChild(i);const l=(u-this.minValue)/a*100,s=o/e.offsetWidth*100/2,r=100-s;i.style.left=`${Math.min(r,Math.max(s,l))}%`}e.appendChild(t),u+=p}}updateFormInputs(){this.rangeContainer.querySelector(".control_container.from .year_button").textContent=this.fromValue,this.rangeContainer.querySelector(".control_container.to .year_button").textContent=this.toValue,e(this.fromSlider,this.toSlider),"function"==typeof this.onChangeCallback&&this.onChangeCallback(this.fromValue,this.toValue)}}let s;function c(e,t){console.log(e,t)}function d(e,t){console.log("add_to_collection()");var a=new FormData;a.append("collection",e),a.append("place_list",t),a.append("csrfmiddlewaretoken","{{ csrf_token }}"),$.ajax({type:"POST",enctype:"multipart/form-data",url:"/collections/add_places/",processData:!1,contentType:!1,cache:!1,data:a,success:function(e){var t=e.msg.dupes,a=e.msg.added;if(t.length>0){let e=t.length+" records "+(t.length>1?"were":"was")+" already in the collection: ["+t;a.length>0&&(e+="]; "+a.length+" "+(a.length>1?"were":"was")+" added"),alert(e)}else $("#added_flash").fadeIn().delay(2e3).fadeOut(),s=[];$(".table-chk").prop("checked",!1)}}),console.log("add_to_collection() completed"),$("#addtocoll_popup").hide(),$("#sel_count").html(""),$("#selection_status").css("display","none")}function p(){$("#placetable tbody tr").click((function(){const e=$(this),t=$(this)[0].cells[0].textContent;if(1==loggedin)if(chkbox=e[0].cells[3].firstChild,chkbox.checked)console.log("chkbox.checked"),s.push(t),$("#selection_status").fadeIn(),console.log("checked_rows",s),$("#sel_count").html(" "+s.length+" ");else{const e=s.indexOf(t);e>-1&&(s.splice(e,1),0==s.length&&($("#addtocoll").fadeOut(),$("#addtocoll_popup").hide())),console.log(t+" removed from checked_rows[]",s)}const a=_.find((function(e){return e.properties.pid==t})).geometry,n=a.coordinates;var i=$(this).hasClass("highlight-row");$("#placetable tr").removeClass("highlight-row"),i||$(this).removeClass("rowhover"),$(this).addClass("highlight-row"),function(e,t,a){t.type.includes("Point")?(y.setPaintProperty("gl_active_point","circle-opacity",1),y.setPaintProperty("gl_active_point","circle-radius",{property:"pid",type:"categorical",default:3,stops:[[Number(e),8]]}),y.setPaintProperty("gl_active_point","circle-stroke-color",{property:"pid",type:"categorical",stops:[[Number(e),"#666"]]}),y.setPaintProperty("gl_active_point","circle-stroke-width",{property:"pid",type:"categorical",stops:[[Number(e),1]]}),y.setPaintProperty("gl_active_point","circle-color",{property:"pid",default:"#ff9900",type:"categorical",stops:[[Number(e),"red"]]})):t.type.includes("Polygon")?(y.setPaintProperty("gl_active_poly","fill-outline-color",{property:"pid",default:"grey",type:"categorical",stops:[[Number(e),"red"]]}),y.setPaintProperty("gl_active_poly","fill-color",{property:"pid",default:"rgba(255,255,255,0.0)",type:"categorical",stops:[[Number(e),"rgba(0,128,0,1.0)"]]})):t.type.includes("Line")&&(y.setPaintProperty("gl_active_line","line-color",{property:"pid",default:"lightgreen",type:"categorical",stops:[[Number(e),"green"]]}),y.setPaintProperty("gl_active_line","line-width",{property:"pid",default:1,type:"categorical",stops:[[Number(e),2]]}));if("point"==t.type.toLowerCase()){const e={center:"number"==typeof a[0]?a:a[0],zoom:7};y.flyTo({...e,padding:b})}else v=turf.envelope(t).bbox,y.fitBounds(v,{padding:b})}(t,a,n),u(t)}));const e=$("#ds_table table tbody")[0].rows[0],t=parseInt(e.cells[0].textContent);$("#placetable tbody").find("tr").eq(0).addClass("highlight-row"),u(t)}function u(e){console.log("getPlace()",e),$.ajax({url:"/api/place/"+e}).done((function(e){$("#detail").html(function(e){function t(e){const t=new Map,a=[];for(const n of e)t.has(n.identifier)||(t.set(n.identifier,!0),a.push({identifier:n.identifier,type:n.type,aug:n.aug}));return a}window.featdata=e;var a='<p><b>Title</b>: <span id="row_title" class="larger text-danger">'+e.title+"</span>";for(var n in a+='<p class="scroll65"><b>Variants</b>: ',e.names){let t=e.names[n];a+="<p>"+t.toponym!=""?t.toponym+"; ":""}a+="</p><p><b>Types</b>: ";var i="";for(var o in e.types){var s="",c=e.types[o];if("sourceLabels"in c)for(l in srclabels=c.sourceLabels,srclabels)label=srclabels[l].label,s=""!=label?label+"; ":"";else"sourceLabel"in c&&(s=""!=c.sourceLabel?c.sourceLabel+"; ":"");""!=c.label&&(s+=m(c)+" "),i+=s}a+=i.replace(/(; $)/g,"")+"</p>",a+='<p class="mb-0"><b>Links</b>: ';if(e.links.length>0)for(l in links=e.links,links_arr=t(e.links),links_arr)a+=h(links_arr[l].identifier);else a+="<i class='small'>no links established yet</i>";if(a+="</p>",e.related.length>0){for(r in parent='<p class="mb-0"><b>Parent(s)</b>: ',related='<p class="mb-0"><b>Related</b>: ',e.related)rel=e.related[r],"gvp:broaderPartitive"==rel.relation_type?(parent+='<span class="small h1em">'+rel.label,parent+="when"in rel&&!("timespans"in rel.when)?", "+rel.when.start.in+"-"+rel.when.end.in:"when"in rel&&"timespans"in rel.when?", "+f(rel.when.timespans):"",parent+="</span>; "):related+='<p class="small h1em">'+rel.label+", "+rel.when.start.in+"-"+rel.when.end.in+"</p>";a+=parent.length>39?parent:"",a+=related.length>37?related:""}e.descriptions.length>0&&(val=e.descriptions[0].value.substring(0,300),a+="<p><b>Description</b>: "+(val.startsWith("http")?'<a href="'+val+'" target="_blank">Link</a>':val)+" ... </p>");e.countries&&(a+="<p><b>Modern country bounds</b>: "+e.countries.join(", ")+"</p>");e.minmax&&e.minmax.length>0&&(a+="<p><b>When</b>: earliest: "+e.minmax[0]+"; latest: "+e.minmax[1]);return a+="</div>"}(e)),spinner_detail.stop(),$(".ext").on("click",(function(e){if(e.preventDefault(),str=$(this).text(),"http"==str.substring(0,4).toLowerCase())url=str;else{var t=/(http|bnf|cerl|dbp|gn|gnd|gov|loc|pl|tgn|viaf|wd|wdlocal|whg|wp):(.*?)$/;url=base_urls[str.match(t)[1]]+str.match(t)[2],console.log("url",url)}window.open(url,"_blank")})),$(".exttab").on("click",(function(e){e.preventDefault(),id=$(this).data("id"),console.log("id",id);var t=/(http|dbp|gn|tgn|wd|loc|viaf|aat):(.*?)$/;url="http"==id.match(t)[1]?id:base_urls[id.match(t)[1]]+id.match(t)[2],console.log("url",url),window.open(url,"_blank")}))}))}function h(e){if(e.startsWith("http")){let t=e.replace(/.+\/\/|www.|\..+/g,"");link='<a href="'+e+'" target="_blank">'+t+'<i class="fas fa-external-link-alt linky"></i>,  </a>'}else link='<a href="" class="ext" data-target="#ext_site">'+e+'&nbsp;<i class="fas fa-external-link-alt linky"></i></a>, ';return link}function m(e){return' <a href="#" class="exttab" data-id='+e.identifier+">("+e.label+' <i class="fas fa-external-link-alt linky"></i>)</a>'}$("[rel='tooltip']").tooltip(),new ClipboardJS("#a_clipcite").on("success",(function(e){console.log("clipped"),e.clearSelection(),$("#a_clipcite").tooltip("hide").attr("data-original-title","copied!").tooltip("show")})),$("#clearlines").click((function(){y.removeLayer("gl_active_poly"),y.removeLayer("outline")})),$("#create_coll_link").click((function(){console.log("open title input"),$("#title_form").show()})),$(".a_addtocoll").click((function(){coll=$(this).attr("ref"),pids=s,d(coll,pids)})),$("#b_create_coll").click((function(){let e=$("#title_input").val();if(""!=e){var t=new FormData;t.append("title",e),t.append("csrfmiddlewaretoken","{{ csrf_token }}"),$.ajax({type:"POST",enctype:"multipart/form-data",url:"/collections/flash_create/",processData:!1,contentType:!1,cache:!1,data:t,success:function(e){el=$('<li><a class="a_addtocoll" href="#" ref='+e.id+">"+e.title+"</a></li>"),el.click((function(){coll=e.id,pids=s,d(coll,pids),console.log("pids to coll",pids,coll)})),$("#my_collections").append(el)}}),$("#title_form").hide()}else alert("Your new collection needs a title!")})),$(".table-chk").click((function(e){e.preventDefault(),console.log("adding",$(this).data("id"))})),$((function(){var e="true"===localStorage.getItem("isCollapsed");e&&($("#ds_info").css("height","40px"),$("#expandIcon").show(),$("#collapseIcon").hide(),$("#iconLabel").text("Show Detail")),$("#toggleIcon").click((function(){e?($("#ds_info").css("height","fit-content"),$("#expandIcon").hide(),$("#collapseIcon").show(),$("#iconLabel").text("Hide"),e=!1):($("#ds_info").css("height","40px"),$("#expandIcon").show(),$("#collapseIcon").hide(),$("#iconLabel").text("Show Detail"),e=!0),localStorage.setItem("isCollapsed",e)})),$("#checkbox").change((function(){localStorage.setItem("isCollapsed",$(this).is(":checked"))})),s=[],localStorage.setItem("filter","99");const t=1==loggedin?{data:"chk"}:{data:"chk",visible:!1};window.spinner_table=new Spin.Spinner(g).spin(),$("#drftable_list").append(spinner_table.el),window.spinner_detail=new Spin.Spinner(g).spin(),$("#row_detail").append(spinner_detail.el);const a=$("#placetable").DataTable({dom:"<'row small'<'col-sm-7'f><'col-sm-5'>><'row'<'col-sm-12'tr>><'row small'<'col-sm-12'p>>",serverSide:!0,ajax:{url:"/api/placetable/?format=datatables&ds="+dslabel},select:!0,order:[[0,"asc"]],pageLength:25,LengthMenu:[25,50,100],columns:[{data:"id"},{data:"title"},{data:"geo"},t],columnDefs:[{orderable:!1,targets:[0,2,3]},{searchable:!1,targets:[0,2,3]}]});$("#addchecked").click((function(){console.log("clicked #addchecked"),$("#addtocoll_popup").fadeIn()})),$(".closer").click((function(){$("#addtocoll_popup").hide()})),a.on("draw",(function(){if(console.log("table drawn"),spinner_table.stop(),s.length>0){for(i in s)$("[data-id="+s[i]+"]").prop("checked",!0);$("#selection_status").show()}p()})),$(".help-matches").click((function(){page=$(this).data("id"),console.log("help:",page),$(".selector").dialog("open")})),$(".selector").dialog({resizable:!1,autoOpen:!1,height:500,width:700,title:"WHG Help",modal:!0,buttons:{Close:function(){console.log("close dialog"),$(this).dialog("close")}},open:function(e,t){$("#helpme").load("/media/help/"+page+".html")},show:{effect:"fade",duration:400},hide:{effect:"fade",duration:400}})})),$("[rel='tooltip']").tooltip();function f(e){for(t in starts=[],ends=[],e)starts.push(Object.values(e[t].start)[0]),ends.push(e[t].end?Object.values(e[t].end)[0]:-1);return minmax=[Math.max.apply(null,starts),Math.max.apply(null,ends)],minmax}const g={scale:.5,top:"50%"};maptilersdk.config.apiKey=mapParameters.mapTilerKey;var y=new maptilersdk.Map({container:mapParameters.container,center:mapParameters.center,zoom:mapParameters.zoom,minZoom:mapParameters.minZoom,maxZoom:mapParameters.maxZoom,attributionControl:!1,geolocateControl:!1,navigationControl:!1});let b,v,_,C;mapParameters.controls.navigation&&map.addControl(new maptilersdk.NavigationControl,"top-left");class k{onAdd(){return this._map=map,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.textContent="Basemap",this._container.innerHTML='<button type="button" class="style-button" aria-label="Change basemap style" title="Change basemap style"><span class="maplibregl-ctrl-icon" aria-hidden="true"></span></button>',this._container.querySelector(".style-button").addEventListener("click",this._onClick.bind(this)),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}_onClick(){let e=document.getElementById("mapStyleList");if(!e){e=document.createElement("ul"),e.id="mapStyleList",e.className="maplibre-styles-list";const t=mapParameters.styleFilter.map((e=>e.split(".")[0]));for(const a of Object.values(maptilersdk.MapStyle))if(0==mapParameters.styleFilter.length||t.includes(a.id)){const t=document.createElement("li");t.textContent=a.name,t.className="group-item";const n=document.createElement("ul");n.className="variant-list";for(const e of a.orderedVariants){const t=a.id+"."+e.variantType;if(0==mapParameters.styleFilter.length||mapParameters.styleFilter.includes(t)){const a=document.createElement("li");a.textContent=e.name,a.className="variant-item",a.dataset.value=t,a.addEventListener("click",this._onVariantClick.bind(this)),n.appendChild(a)}}t.appendChild(n),e.appendChild(t)}this._container.appendChild(e)}e.classList.toggle("show")}_onVariantClick(e){const t=e.target.dataset.value;console.log("Selected variant: ",t);const a=t.split(".");y.setStyle(maptilersdk.MapStyle[a[0]][a[1]]),w(pageData);const n=document.getElementById("mapStyleList");n&&n.classList.remove("show")}}function w(e){y.getLayer("gl_active_point")&&(y.removeLayer("gl_active_point"),y.removeLayer("gl_active_line"),y.removeLayer("gl_active_poly"),y.removeLayer("outline"),y.removeSource("places")),$.get("/datasets/"+e+"/geojson",(function(e){_=e.collection.features;const t=turf.envelope(e.collection);y.addSource("places",{type:"geojson",data:e.collection}),y.getSource("empty")||y.addSource("empty",{type:"geojson",data:{type:"FeatureCollection",features:[]}});for(let e=4;e>0;e--)y.getLayer("z-index-"+e)||y.addLayer({id:"z-index-"+e,type:"symbol",source:"empty"},4==e?"":"z-index-"+(e+1));y.addLayer({id:"gl_active_point",type:"circle",source:"places",paint:{"circle-opacity":1,"circle-color":"#ff9900","circle-radius":{stops:[[1,2],[3,3],[16,10]]}},filter:["==","$type","Point"]},"z-index-4"),y.addLayer({id:"outline",type:"line",source:"places",layout:{},paint:{"line-color":"#999","line-width":1,"line-dasharray":[4,2],"line-opacity":.5},filter:["==","$type","Polygon"]},"z-index-3"),y.addLayer({id:"gl_active_poly",type:"fill",source:"places",paint:{"fill-color":"#ddd","fill-opacity":.3,"fill-outline-color":"#666"},filter:["==","$type","Polygon"]},"z-index-2"),y.addLayer({id:"gl_active_line",type:"line",source:"places",paint:{"line-color":"#336699","line-width":{stops:[[1,1],[4,2],[16,4]]}},filter:["==","$type","LineString"]},"z-index-1"),v=t.bbox,y.fitBounds(v,{padding:b,duration:0}),console.log("Data layers added, map fitted.",v,b)}))}1!==mapParameters.styleFilter.length&&y.addControl(new k,"top-right"),C=0==mapParameters.styleFilter.length?["DATAVIZ","DEFAULT"]:mapParameters.styleFilter[0].split("."),y.setStyle(maptilersdk.MapStyle[C[0]][C[1]]),y.addControl(new maptilersdk.AttributionControl({compact:!0,customAttribution:"WHG"}),"bottom-right"),y.on("load",(function(){const e=document.getElementById(mapParameters.container),t=document.querySelector(".maplibregl-control-container");t.setAttribute("id","mapControls"),t.classList.add("item");const a=document.createElement("div");function n(){const e=document.getElementById("mapControls").getBoundingClientRect(),t=document.getElementById("mapOverlays").getBoundingClientRect();b={top:e.top-t.top,bottom:t.bottom-e.bottom,left:e.left-t.left,right:t.right-e.right},v&&(Array.isArray(v)||!v.hasOwnProperty("center")?y.fitBounds(v,{padding:b,duration:0}):y.flyTo({...v,padding:b,duration:0}))}a.id="mapOverlays",e.appendChild(a),["left","right"].forEach((function(e){const n=document.createElement("div");n.classList.add("column",e),a.appendChild(n);document.querySelectorAll(".overlay."+e).forEach((function(e){n.appendChild(e),e.classList.add("item")})),"left"==e&&n.appendChild(t)}));const i=new ResizeObserver((e=>{n()}));if(n(),i.observe(document.getElementById("mapControls")),i.observe(document.getElementById("mapOverlays")),v=y.getBounds(),y.fitBounds(v,{padding:b,duration:0}),e.style.opacity=1,0==mapParameters.controls.attribution.open&&setTimeout((()=>{var e=document.querySelector(".maplibregl-ctrl-attrib-button");e&&(e.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window})),document.querySelector(".maplibregl-ctrl-attrib").classList.add("fade-in"))}),0),mapParameters.controls.temporal){const e=document.createElement("div");e.id="dateline",document.getElementById("mapControls").appendChild(e);new o({...mapParameters.controls.temporal,onChange:c})}w(pageData);const l=["outline","gl_active_point","gl_active_line","gl_active_poly"];for(var s in l)y.on("mouseenter",l[s],(function(){y.getCanvas().style.cursor="pointer"})),y.on("mouseleave",l[s],(function(){y.getCanvas().style.cursor=""})),y.on("click",l[s],(function(e){const t=e.features[0].layer.type,a=e.features[0].geometry.type,n=e.features[0].geometry,i=e.features[0].geometry.coordinates;e.features[0];if("point"==t)var o=n.coordinates.slice();else if("line"==t)if("LineString"==a){const e=Math.round(n.coordinates.length/2);o=n.coordinates[e]}else{const e=turf.lineString(i[Math.round(i.length/2)]),t=turf.length(e);o=turf.along(e,t/2).geometry.coordinates}else o=turf.centroid(n).geometry.coordinates;var l=e.features[0].properties.pid,s=e.features[0].properties.title,r=(e.features[0].properties.src_id,e.features[0].properties.minmax);for(e.features[0].properties.fclasses;Math.abs(e.lngLat.lng-o[0])>180;)o[0]+=e.lngLat.lng>o[0]?360:-360;(new maptilersdk.Popup).setLngLat(o).setHTML("<b>"+s+'</b><br/><a href="#" class="fetch-info-link" data-pid="'+l+'">fetch info</a><br/>start, end: '+r).addTo(y)}));document.addEventListener("click",(function(e){if(e.target&&e.target.classList.contains("fetch-info-link")){u(e.target.getAttribute("data-pid")),e.preventDefault()}}))}))})();