# migration out from v2


PlaceType
=========
psql -U whgadmin -d whgv2 -c "COPY (SELECT row_to_json(t) FROM (SELECT * FROM place_type) t) TO '/home/whgadmin/sites/data_dumps/exported_placetype_20240526.jsonl';"

PlaceLink
=========
psql -U whgadmin -d whgv2 -c "COPY (SELECT row_to_json(t) FROM (SELECT * FROM place_link) t) TO '/home/whgadmin/sites/data_dumps/exported_placelink_20240526.jsonl';"

PlaceName
=========
psql -U whgadmin -d whgv2 -c "COPY (SELECT row_to_json(t) FROM (SELECT * FROM place_name) t) TO '/home/whgadmin/sites/data_dumps/exported_placename_20240525.jsonl';"

Place
=====
COPY (
    SELECT p.id, p.title,
           COALESCE(NULLIF(p.attestation_year::text, ''), NULL) AS attestation_year,
           p.ccodes, p.dataset, p.fclasses, p.flag, p.idx_pub, p.indexed,
           CASE WHEN p.minmax IS NULL THEN NULL ELSE p.minmax END AS minmax,
           COALESCE(NULLIF(p.review_tgn::text, ''), NULL) AS review_tgn,
           COALESCE(NULLIF(p.review_wd::text, ''), NULL) AS review_wd,
           COALESCE(NULLIF(p.review_whg::text, ''), NULL) AS review_whg,
           p.src_id, p.timespans, d.create_date, false AS idx_builder
    FROM places p
    JOIN datasets d ON p.dataset = d.label
    WHERE dataset IN (SELECT label FROM datasets)
    ORDER BY id
) TO '/home/whgadmin/sites/data_dumps/exported_places_20240525.csv' WITH CSV HEADER NULL '\N';
