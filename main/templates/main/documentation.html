{% extends "main/base.html" %}
{% load static %}

{% load mathfilters %}
{% load dataset_extras %}

{% block extra_head %}
<style>
  .nav-link {
    color: #007bff;
    transition: color 0.3s;
  }

  .nav-link:hover {
    color: #0056b3;
  }
  #docs_content, #docs_sidebar {
      overflow-y: auto;
      height: calc(100vh - 120px);
  }
  @media (max-width: 992px) { /* adjust this value as needed */
    .accordion-body {
      padding: unset !important;
    }
  }
</style>
{% endblock %}

{% block content %}
<div id="docs_container" class="container mt-1 px-1">
  <div><h4>WHG v3 Documentation</h4></div>
  <div class="row flex-nowrap">
    <!-- Sidebar Navigation with Accordions -->
    <div id="docs_sidebar" class="col-md-3 col-4 sticky-sidebar">
      <div class="accordion" id="sidebarAccordion">
        <!-- Introduction Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingIntro">
            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseIntro" aria-expanded="true" aria-controls="collapseIntro">
              Introducing the WHG
            </button>
          </h2>
          <div id="collapseIntro" class="accordion-collapse collapse show" aria-labelledby="headingIntro"
               data-bs-parent="#sidebarAccordion">
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link" href="#overview">Overview</a></li>
                <li class="nav-item"><a class="nav-link" href="#purpose">Purpose</a></li>
              </ul>
            </div>
          </div>
        </div>
        <!-- Workbench Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingWorkbench">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseWorkbench" aria-expanded="false" aria-controls="collapseWorkbench">
              Workbench Pathways
            </button>
          </h2>
          <div id="collapseWorkbench" class="accordion-collapse collapse" aria-labelledby="headingWorkbench"
               data-bs-parent="#sidebarAccordion">
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link" href="#augment">Upload and augment place data</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#publish_ds">Publish your dataset as a gazetteer resource</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#dscoll">Assemble a gazetteer from multiple datasets</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#pcoll">Author a thematic place collection</a></li>
              </ul>
            </div>
          </div>
        </div>
        <!-- Site Sections Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingSections">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseSections" aria-expanded="false" aria-controls="collapseSections">
              Site Sections
            </button>
          </h2>
          <div id="collapseSections" class="accordion-collapse collapse" aria-labelledby="headingSections"
               data-bs-parent="#sidebarAccordion">
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link" href="#home">Home page</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#search">Search for places</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#portal">Place Portals</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#gallery">Browse publications</a></li>
              </ul>
            </div>
          </div>
        </div>
        <!-- Tutorials Section -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTutorials">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseTutorials" aria-expanded="false" aria-controls="collapseTutorials">
              Tutorials
            </button>
          </h2>
          <div id="collapseTutorials" class="accordion-collapse collapse" aria-labelledby="headingTutorials"
               data-bs-parent="#sidebarAccordion">
            <div class="accordion-body">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <a class="nav-link" href="#pathways">Workflow Pathways</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#lpf">Linked Places format</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#prepdata">Preparing data for upload</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#pcolls">Create and publish a Place Collection</a></li>
                <li class="nav-item">
                  <a class="nav-link" href="#dscolls">Create and publish a Dataset Collection</a></li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
    <!-- Main Content -->
    <div id="docs_content" class="col-md-9 col-8 content-area">
      <!--Introduction Group -->
      <section id="introduction">
        <h4>Introduction</h4>
        <hr/>
        <h5>Vision and mission</h5>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="overview">
        <h5>Overview</h5>
        <p>Overview of WHG, its purpose, and main features...</p>
                <p>{% lorem 2 %}</p>
      </section>
      <section id="purpose">
        <h5>Purpose</h5>
        <p>Purpose of WHG and main features...</p>
                <p>{% lorem 2 %}</p>
      </section>
      <!-- Workbench Group -->
      <section id="augment">
        <h4>Workbench Pathways</h4>
        <hr/>
        <h5>Upload and augment place data</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="publish_ds">
        <h5>Publish your dataset as a gazetteer resource</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="dscoll">
        <h5>Assemble a gazetteer from multiple datasets</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="pcoll">
        <h5>Author a thematic place collection</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <!-- Site Sections Group -->
      <section id="home">
        <h4>Site Sections</h4>
        <hr/>
        <h5>Home page</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="search">
        <h5>Search in WHG</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="portal">
        <h5>Place Portals</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="gallery">
        <h5>Browse data publications</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <!-- Tutorials Group -->
      <section id="pathways">
        <h4>Guides and Tutorials</h4>
        <hr/>
        <h5>Workflow Pathways</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="lpf">
        <h5>Linked Places format</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="prepdata">
        <h5>Preparing data for upload</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="pcolls">
        <h5>Create and publish a Place Collection</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
      </section>
      <section id="dscolls">
        <h5>Create and publish a Dataset Collection</h5>
        <p>...</p>
        <p>{% lorem 2 %}</p>
        <p>{% lorem 8 %}</p>
      </section>
  </div>
</div>
</div>
<script type="text/javascript">

$(document).ready(function() {
  // Get the hash from the URL
  var hash = window.location.hash;
  if (!hash) {
    console.log('No hash found in the URL.');
    return;
  } else {
    console.log('Hash:', hash);
  }

  // Find the nav link that corresponds to the hash
  var navLink = $(`.nav-link[href="${hash}"]`);
  if (!navLink.length) {
    console.log('No nav link found for the hash.');
    return;
  } else {
    console.log('Nav link:', navLink);
  }

  // Find the parent accordion item of the nav link
  var accordionItem = navLink.closest('.accordion-item');
  if (!accordionItem.length) {
    console.log('No parent accordion item found for the nav link.');
    return;
  } else {
    console.log('Parent accordion item:', accordionItem);
  }

  // Find the accordion collapse element within the accordion item
  var accordionCollapse = accordionItem.find('.accordion-collapse');
  if (!accordionCollapse.length) {
    console.log('No accordion collapse element found within the accordion item.');
    return;
  } else {
    console.log('Accordion collapse element:', accordionCollapse);
  }

  // Use Bootstrap's JavaScript API to show the accordion collapse
  accordionCollapse.collapse('show');

  // Scroll to the target element
  $('html, body').animate({
    scrollTop: $(hash).offset().top
  }, 800);
});

$(document).ready(function() {
  console.log('Document is ready.');

  // Get the hash from the URL
  var hash = window.location.hash;
  if (!hash) {
    console.log('No hash found in the URL.');
    return;
  } else {
    console.log('Hash:', hash);
  }

  // Find the nav link that corresponds to the hash
  var navLink = $(`.nav-link[href="${hash}"]`);
  if (!navLink.length) {
    console.log('No nav link found for the hash.');
    return;
  } else {
    console.log('Nav link:', navLink);
  }

  // Find the parent accordion item of the nav link
  var accordionItem = navLink.closest('.accordion-item');
  if (!accordionItem.length) {
    console.log('No parent accordion item found for the nav link.');
    return;
  } else {
    console.log('Parent accordion item:', accordionItem);
  }

  // Find the accordion collapse element within the accordion item
  var accordionCollapse = accordionItem.find('.accordion-collapse');
  if (!accordionCollapse.length) {
    console.log('No accordion collapse element found within the accordion item.');
    return;
  } else {
    console.log('Accordion collapse element:', accordionCollapse);
  }

  // Use Bootstrap's JavaScript API to show the accordion collapse
  accordionCollapse.collapse('show');

  // Scroll to the target element
  $('html, body').animate({
    scrollTop: $(hash).offset().top
  }, 800);


  var sidebarAccordion = $('#sidebarAccordion');
  if (!sidebarAccordion.length) {
    console.error('Sidebar accordion not found!');
    return;
  } else {
    console.log('Sidebar accordion found:', sidebarAccordion);
  }

  sidebarAccordion.on('show.bs.collapse', function (e) {
    console.log('Accordion section is showing:', e.target);

    // Find the closest .accordion-collapse to ensure we have the correct container
    var accordionBody = $(e.target).closest('.accordion-collapse');
    if (!accordionBody.length) {
      console.error('Accordion collapse element not found.');
      return;
    } else {
      console.log('Accordion collapse element:', accordionBody);
    }

    // Delay the action to wait for the collapse animation to complete
    setTimeout(() => {
      // Locate the first navigation link in the opened accordion body
      var firstNavItem = accordionBody.find('.nav-link');
      if (!firstNavItem.length) {
        console.error('No nav item found in the opened accordion section.');
        return;
      } else {
        console.log('First nav item:', firstNavItem);
      }

      // Get the href attribute from the first nav item
      var targetId = firstNavItem.attr('href');
      if (!targetId) {
        console.error('Nav item href attribute is missing.');
        return;
      } else {
        console.log('Nav item href:', targetId);
      }

      // Locate the content section that corresponds to the nav item's href
      var targetElement = $(targetId);
      if (!targetElement.length) {
        console.error('Target element not found:', targetId);
        return;
      } else {
        console.log('Target element to scroll to:', targetElement);
      }

      // Execute the scroll to the target element
      $('html, body').animate({
        scrollTop: targetElement.offset().top
      }, 800);
    }, 300);
  });
});

</script>

{% endblock %}
