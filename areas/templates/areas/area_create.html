<!-- areas/area_create.html -->
{% extends "main/base_webpack.html" %}
{% load static %}
{% load dataset_extras %}

{% block extra_head %}
	<link href="{% static 'webpack/whg_maplibre.bundle.css' %}" rel="stylesheet" />
	<link href="{% static 'webpack/areas.bundle.css' %}" rel="stylesheet" />
{% endblock %}

{% block title %}
	<title>WHG::Create/Update Area</title>
{% endblock %}

{% block content %}
<div class="container">
  <h4 class="mt-3">
    {% if action == 'update' %}
        Update Study Area
        <span class="text-danger">"{{ form.title.value }}"</span>
	      {% comment %}
        <span class="ms-3 half">
            (<mark id="count_result">{{ object.count_public }}</mark> places from public datasets lie within this area)
        </span>
        {% endcomment %}
        <a href="{% url 'areas:area-delete' object.id %}" class="float-end"
        title="Delete area feature" rel="tooltip" style="margin-top:-2px;">
        <i class="fas fa-trash linkyred"></i></a>
    {% else %}
        Create Study Area
    {% endif %}
  </h4>
  <div class="d-flex">
    <div class="form-box mt-2 col-sm-4">
    <form id="area_form" method="POST" action="#" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="owner" value='{{ user.id }}'></input>
      {% if action == 'update' %}
        <input type="hidden" name="type" value='{{ form.type.value }}' />
      {% else %}
        <input type="hidden" name="type" value='ccodes' />
      {% endif %}
      <p>Title<br/>{{ form.title }}</p>
      <p><span class="top">Description</span><br/>{{ form.description }}</p>
      <hr/>
      <div id="area_options">
        <ul id="area_tabs_ul" class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active" role="tab" data-bs-toggle="tab" ref="ccodes" href="#areas_codes">Countries</a></li>
          <li class="nav-item">
            <a class="nav-link" role="tab" data-bs-toggle="tab" ref="drawn" href="#areas_draw">Draw</a></li>
        </ul>
        <div class="tab-content">
          <div id="areas_codes" class="tab-pane fade active show">
            <p id="p_ccodes">Country codes (ISO 3166 alpha2) &nbsp;<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2" target="_blank"><i class="fas fa-external-link-alt linky"></i></a><br/>{{ form.ccodes }}
              <span class="float-end ms-1 area-link-clear">
                <a href="javascript:void(0);">clear</a></span>
              <span class="float-end area-link-render">
                <a href="javascript:void(0);">preview</a> |</span>
            </p>
            <p>Buffer (optional, km)<br/>
              <input type="text" id="buffer_km" name="buffer_km" value=""/></p>
          </div>
          <div id="areas_draw" class="tab-pane fade in">
            <p>Use map controls to draw/edit bounding box or polygon</p></div>
        </div>
	      <p class="mt-2">GeoJSON<br/>{{ form.geojson }}</p>
      </div> <!-- area_options -->
      <p id="referrer"></p>
      <input class="btn-sm btn-primary mt-2" type="submit" value="Save" />
      <span title="back"><a href="{% url 'dashboard' %}">Cancel</a></span>
    </form>
    </div>
    <div id="map" class="col-sm-8">
    </div>
  </div> <!-- d-flex -->
</div> <!-- container -->

<script type="text/javascript">
    let action = '{{ action }}';
    let formType = '{{ form.type.value }}';
    let formGeoJSON = '{{ form.geojson.value|safe }}';
</script>

{% endblock %}

{% block deferredScripts %}
   	
   	var scripts = [
		{
			src: '{% static 'webpack/whg_maplibre.bundle.js' %}',
			type: 'text/javascript',
		},
		{
			src: '{% static 'webpack/areas.bundle.js' %}',
			type: 'module',
		},
   	]

{% endblock %}
