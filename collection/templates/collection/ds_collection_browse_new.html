{% extends "main/base.html" %}
{% load static %}
{% load leaflet_tags %}

{% load mathfilters %}
{% load dataset_extras %}

{% block extra_head %}
	<!-- Datatables does not function with Webpack except in browsers >~ 2021 - see https://datatables.net/blog/2022-11-10-esm -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.24/b-1.7.0/b-colvis-1.7.0/b-html5-1.7.0/cr-1.5.3/fh-3.1.8/sc-2.0.3/sp-1.2.2/sl-1.3.3/datatables.min.css" />
	<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.24/b-1.7.0/b-colvis-1.7.0/b-html5-1.7.0/cr-1.5.3/fh-3.1.8/sc-2.0.3/sp-1.2.2/sl-1.3.3/datatables.min.js"></script>
	<link href="{% static 'webpack/whg.bundle.css' %}" rel="stylesheet" />
{% endblock %}

{% block title %}<title>Collection::{{ object.title }}</title>{% endblock %}

{% block content %}
<div id="dataset_content" class="container mt-1 px-1">

	<div id="map" style="height:100%;"></div>
	<div id="ds_info" class="overlay left">
		<div id="dscoll_header">
			<span class="fs-5 title">
				<img src="{% static 'images/010-jigsaw.png'%}" class="" height=28 alt=""/>
				{{ object.title }}
			</span>
	    <span id="toggleIcon" class="float-end">
	        <span id="iconLabel" class="small">Hide</span>
	        <i id="expandIcon" class="fas fa-chevron-down" style="display: none;"></i>
	        <i id="collapseIcon" class="fas fa-chevron-up"></i>
	    </span>
		</div> <!-- dscoll_header -->
		<div id="metadata" class="mt-2">
			<div class="row">
				<div class="col-sm-8">
					<p>{{ object.description|safe }}</p>
				</div>
				<div class="col-sm-4" style="position: relative;">
		      {% if object.image_file %}
		        <a href="#" class="pop">
		            <img id="active_img" class="img-responsive thumbnail float-end"
		           src="/media/{{ object.image_file.name }}" width="220px" /></a>
		      {% else %}
		      <span><i>image here</i></span>
		      {% endif %}
				</div>
			</div>
			<div class="mt-3" >
      <table>
        <tr><td><b>Keywords</b></td><td>{{ object.keywords|join:', ' }}</td></tr>
        {% if links|length > 0 %}
	        <tr><td><b>Links</b></td>
		        <td>
			        {% for l in links %}
				        <a href="{{ l.uri }}" target="_blank">{{ l.label }}</a>;
			        {% endfor %}
		        </td></tr>
        {% endif %}
        {% if object.webpage %}
        <tr><td><b>Webpage</b></td><td>
          <a href="{{object.webpage }}" target="_blank">
	          link <i class="fas fa-external-link-alt linky"></i></a>
        </td></tr>
        {% endif %}
        {% if object.file %}
        <tr>
	        <td><b>Essay(s)</b></td>
	        <td><a href="/media/{{ object.file }}" target="_blank"> <i class="fas fa-file-pdf linky"></i>
				        {{ object.file.name|filename }}</a></td>
        </tr>
        {% endif %}
        {% if object.creator %}
          <tr><td><b>Creator(s)</b></td><td>{{ object.creator }}</td></tr>
        {% endif %}
        {% if object.contact %}
          <tr><td><b>Contact</b></td>
	          <td>{{ object.contact|url_it|safe }}</td></tr>
        {% endif %}
      </table>
			</div>
			<div class="mt-3" style="border-top: 1px solid gainsboro;">
				<i class="fas fa-download linky"></i>
				<a href="" id="a_download_modal" class="a-dl" data-collid = "{{ object.id }}"
				   data-toggle="modal" data-target="#downloadModal"
				   title="download options"> download options</a>
			</div>
			<div class="float-end">
        <label for="checkbox" class="small">Close intro by default</label>
        <input type="checkbox" id="checkbox">
      </div>
		</div>
	</div> <!-- dscoll_info -->
	<div id="ds_table" class="overlay right">
		<div id="ds_filter" class="small"></div>
		<table id="placetable"
		       class="table table-striped table-bordered small" style="width:100%">
      <thead>
        <tr>
          <th>pid</th>
          <th>title</th>
          <th>geo</th>
          <th class="hidden">dataset_id</th>
          <!--<th>ds</th>-->
        </tr>
      </thead>
    </table>
	</div>
	<div id="detail" class="overlay right"></div>

  <div id="ext_site" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span></button>
        </div>
        <div id="ext_content" class="modal-body">foo</div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="" tabindex="-1"
       role="dialog" aria-labelledby="updateModalLabel"
       aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">
          </h5>
        </div>
        <div class="modal-body">
        </div> <!-- .modal-body -->
        <div class="modal-footer">
          <div id="buttons_pre">
            <button id="btn_cancel" type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancel</button>
            <button id="btn_update" type="button" data-dsid={{ds.id}} class="btn btn-primary btn-sm hidden">
              Proceed</button>
          </div>
          <button id="btn_done" type="button" class="btn btn-secondary btn-sm hidden" data-dismiss="modal">Done</button>
        </div>
      </div>
    </div>
  </div>
</div> <!-- dscoll_content -->
	
	<!-- Set up MapLibre map using Maptiler SDK -->
	<script type="text/javascript">
	  let mapParameters = {
	    container: 'map',
	    center: [9.2, 33],
	    zoom: 0.2, // starting zoom
	    minZoom: 0.1,
	    maxZoom: 10,
	    mapTilerKey: 'F8uQKJ8cHQ0tsUSnWKWO', // {{ mbtoken }}
	    controls: {
	      layer: true,
	      navigation: false,
	      fullscreen: false,
	      attribution: {
	        open: false,
	      },
	      temporal: {
	        fromValue: 1550,
	        toValue: 1720,
	        minValue: -2000,
	        maxValue: 2100,
	        open: false,
	        includeUndated: true, // null | false | true - 'false/true' determine state of select box input; 'null' excludes the button altogether
	        epochs: null,
	        automate: null,
	      }
	    },
	    styleFilter: [ /* 'TOPO.PASTEL','BASIC.DEFAULT' */ ], // Leave empty for full list of options, or include a single style to prevent selector inclusion
	  }
	  const pageData = "{{ object.id }}";
	  window.loggedin = "{{ loggedin }}"
	  window.dslabel = "{{ object.label }}"
	  window.filter = "{{ filter }}"
	</script>
    {{ ds_list|json_script:"ds_list_data" }}
	
	<script type="module">
	  import "{% static 'webpack/whg.bundle.js' %}";
	</script>

{% endblock %}
