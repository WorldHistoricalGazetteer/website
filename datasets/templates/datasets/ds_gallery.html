{% extends "main/base.html" %}
{% block title %}<title>WHG::Gallery</title>{% endblock %}

{% block content %}
{#	{% load geojson_tags %}#}
{#	{% load leaflet_tags %}#}
	{% load static %}
	{% load dataset_extras %}
	{% block extra_head %}
	
	<link href="{% static 'webpack/maptiler_sdk.bundle.css' %}" rel="stylesheet" /> 
	<link href="{% static 'webpack/gallery.bundle.css' %}" rel="stylesheet" />
	
	{% endblock %}

	<div class="container pt-2 container-md" style="height: calc(100vh - 65px); position:relative;">
	    <section class="text-center">
		    <div class="container mb-1" style="position:relative">
	            <ul class="nav nav-tabs justify-content-end" id="galleryTabs">
	                <li class="nav-item">
	                    <h3 class="nav-title">Publications</h3>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link active" id="datasets-tab" data-bs-toggle="tab" href="#datasets">Datasets ({{ num_datasets|safe }})</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link" id="collections-tab" data-bs-toggle="tab" href="#collections">Collections ({{ num_collections|safe }})</a>
	                </li>
	            </ul>
		    </div>
		</section>
	    <div class="row">
	        <div id="gallery_bottom" class="col-md-8 mt-2" style="height: 100%; overflow-y: auto;">
	            <div class="ds-gallery w-100">
	                <div id="dynamic-gallery" class="row ps-1 gx-2"></div>
	            </div>
	        </div>
	        <div id="map_column" class="col-md-4">
	        	<div id="page_controls" class="mt-2">
				    {% for button in page_controls %}
				        {% if button == 'dropbox' %}
				            <select title="Select page" aria-label="Select page"></select>
				        {% else %}
				            <button id="{{ button.0 }}" type="button" style="background-image: url(/static/images/sequencer/{{ button.0 }}-btn.svg)" aria-label="{{ button.1 }}" title="{{ button.1 }}"></button>
				    	{% endif %}
				    {% endfor %}
				</div>
	            <label for="sortDropdown">Sort results:</label>
				<select id="sortDropdown">
	                <option value="title">Title</option>
	                <option value="numrows">Smallest</option>
	                <option value="earliest">Earliest</option>
	                <option value="latest">Latest</option>
	                <option value="modified">Recent</option>
	            </select>
	            <label for="reverseSortCheckbox">reverse</label>
	            <input type="checkbox" id="reverseSortCheckbox">
				<div id="map"></div>
	            <input type="text" id="searchInput" placeholder="Filter titles and descriptions"><br/>
				<select id="countryDropdown" class="form-select" data-type="country" data-placeholder="Country filter(s)" multiple></select>
	        </div>
	    </div>
	    <div id="essay_modal" class="selector py-3" style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;"></div>
	</div>

	<script type="text/javascript">
	
    	let mapParameters = {
            container: 'map',
            center: [9.2, 33],
            zoom: 0.2, // starting zoom
            minZoom: 0.1,
            maxZoom: 10,
            mapTilerKey: '{{ maptilerkey }}',
            controls: {
                layer: true,
                navigation: true,
                fullscreen: false,
                attribution: {
                    open: false,
                },
                temporal: false
            },
            styleFilter: [ /* 'TOPO.PASTEL','BASIC.DEFAULT' */ ], // Leave empty for full list of options, or include a single style to prevent selector inclusion
        }
	
		const dropdown_data = {{ dropdown_data|safe }}
		const country_feature_collection = {{ country_feature_collection|safe }}
		
		$(function () {
			$('[data-toggle="tooltip"]').tooltip()
		})

		// resources
		$(".ds-card-content").click(function(){
			dsid = $(this).data('id');
			window.location.href = "/datasets/"+dsid+"/places";
		})
		$(".modal-link").click(function () {
			page = $(this).data('id')
			$('.selector').dialog('open');
		})
		$(".selector").dialog({
				resizable: true,
				autoOpen: false,
				width: $(window).width() * 0.5,
				height: $(window).height() * 0.9,
				title: "Teaching with World Historical Gazetteer",
				modal: true,
				buttons: {
					'Close': function () {
						$(this).dialog('close');
					}
				},
				open: function (event, ui) {
					$('.selector').load('/media/resources/'+page+'.html');
				},
				show: { effect: "fade", duration: 400 },
				hide: { effect: "fade", duration: 400 }
			});

	</script>
	
	<script type="module">
    	import "{% static 'webpack/maptiler_sdk.bundle.js' %}";
    	import "{% static 'webpack/gallery.bundle.js' %}";
	</script> 
{% endblock %}

